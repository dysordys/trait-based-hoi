## Code, data, and current manuscript version for "When do trait-based higher-order interactions and individual variation promote robust species coexistence?"

The manuscript is currently in review at Ecology and Evolution. The repository is structure is explained below.

### `/code`

This directory has all the scripts to replicate our results. Using it requires R 4.3.1 with the full `tidyverse` suite, `withr`, and `Rcpp` packages installed. The latter in turn requires `RcppArmadillo` for tensor computations. All scripts assume that the working directory is the one where the script itself is located. The files directly accessible from `/code` implement the basic models:

-   `launch.R`: This script sets up a reproducible and fully-factorial simulation of the trait-based higher-order interaction (HOI) models described in the manuscript. The current implementation generates input data files plus bash scripts for submitting the individual simulations as jobs on a computing cluster (using slurm).
-   `models.cpp`: A C++ script, written using Rcpp, implementing the models from the main text (evo, evoHOI, hier, and hierHOI).
-   `simOnCluster.R`: Takes the input data generated by `launch.R` and the models in `models.cpp`, and submits each parameterization as an independent job on a computing cluster via slurm.
-   `merge.R`: A helper script to take all the output files produced after running `simOnCluster.R`, and merge them into a single large data file.
-   `processData.R`: Takes as input the large overall data file generated by `merge.R`, and computes summary statistics over each replicate simulation: species richness, species diversity (measured by the inverse Simpson index), trait clustering, and community robustness. It then saves these processed data in a different file.
-   `plots.R`: Takes the processed data file generated by `processData.R`, and creates visualizations of the results.
-   `smoothstep.R`: A simple script visualizing the smoothed, twice continuously differentiable step function used for regularizing the integration of the dynamical equations (see Supplementary Section S6 for details, in `/manuscript/supplement.pdf`).
-   `metricStat.R`: A proof-of-concept demonstration of detecting statistical differences between model versions with- and without higher-order interactions.
-   `plotExamples.R`: Generates the data for re-creating Figure 1 from the manuscript, saves them, and visualizes them.

The subdirectory `/code/wideningHOI` implements a similar workflow, but for versions of the evoHOI and hierHOI models in which purely pairwise effects and evolutionary dynamics are turned off. Its files are:

-   `launch.R`: Sets up a simulation to reproduce Supplementary Figure S6. The implementation generates input data files plus bash scripts for submitting the individual simulations as jobs on a computing cluster (using slurm).
-   `models-eco.cpp`: A C++ script, written using Rcpp, implementing the evolution- and pairwise interaction-free versions of the evoHOI and hierHOI models.
-   `simOnCluster.R`: Takes the input data generated by `launch.R` and the models in `models-eco.cpp`, and submits each parameterization as an independent job on a computing cluster via slurm.
-   `merge.R`: A helper script to take all the output files produced after running `simOnCluster.R`, and merge them into a single large data file.
-   `processData.R`: Takes as input the large overall data file generated by `merge.R`, and computes species richness and species diversity (measured by the inverse Simpson index) over each replicate simulation. It then saves these processed data in a different file.
-   `plots.R`: Takes the processed data file generated by `processData.R`, and visualize the results.

The subdirectory `/code/rigged-width` implements versions of the model where evolutionary dynamics are absent, all intraspecific trait variances are zero, and the kernel widths of the pairwise and higher-order terms can be independently adjusted. Its files are:

-   `create-examples.R`: Generate Figures S7-S14 from Supplementary Section S10.
-   `models-eco.cpp`: Versions of the original evo, evoHOI, hier, and hierHOI models with zero heritabilities, zero intraspecific trait variances, and independently adjustable pairwise and higher-order kernel widths (and heights).
-   `kernel-smoothing.R`: A simple script to create Supplementary Figure S5.

### `/data`

All the final data files that are generated by the scripts in `code`. They should be exactly reproducible, as the scripts use fixed values to seed the random number generator with. The files are:

-   `examples.rds`: Data for generating Figure 1 in the manuscript. It is created by the first part of `/code/plotExamples.R`. (The second part of the same script then reads these data and makes the figure.)
-   `data.rds`: The overall data that is created by first running `/code/simOnCluster.R` and then merging all the results with `/code/merge.R`.
-   `data-processed.rds`: The processed data, with summary statistics over each replicate community, generated by `/code/processData.R`.
-   `widen.rds`: The overall data that is created by first running `/code/wideningHOI/simOnCluster.R` and then merging all the results with `/code/wideningHOI/merge.R`.
-   `widen-processed.rds`: The processed data, with summary statistics over each replicate community, generated by `/code/wideningHOI/processData.R`.

### `/figures`

The figures generated by the scripts. The files directly under `/figures/` are figures in the main text; those under `/figures/SI/` are in the Supplementary.

### `/manuscript`

LaTeX source files and PDFs for the manuscript: `manuscript.tex` and `manuscript.pdf` are the main text, `supplement.tex` and `supplement.pdf` are the Supplementary, and `besjournals-jr.bst` is a bibliography style file.
